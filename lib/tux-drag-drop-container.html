<!--
@license
Copyright (c) 2015 Tux Authors
This code is distributed under the MIT license.  See LICENSE.txt for
details.
-->
<link rel="import" href="../../polymer/polymer.html">
<dom-module id='tux-drag-drop-container'>
  <template>
    <style>
    #wrapper {
      border: none;
      padding: 0px;
      box-sizing: border-box;
    }
    </style>
    <div id='wrapper' class='tux-drag-drop-container-wrapper' zones='[[zones]]'>
      <content></content>
    </div>
  </template>
  <script>
    /**
    * rewraps content contents of an element into a
    * new element
    * old {element} The element to rewrap
    * new {string} Name of the new tag to replace  old with
    * returns the new element
    */
    Polymer({
      is: 'tux-drag-drop-container',
      properties: {
        drake: {
          type: String,
          notify: true,
          value: null
        },
        for: {
          type: String,
          notify: true,
          value: null
        },
        zones: {
          type: String,
          notify: true,
          value: null
        },
        wrapper: {
          type: String,
          notify: true,
          reflectToAttribute: true,
          value: 'div',
        }
      },

      observers: [ '_zonesChange(zones, for)' ],

      isReady: false,

      _zonesChange: function (z, f) {
        var target = this.querySelector(this.for ? this.for :
          '.tux-drag-drop-container');
        if (this.zones)
          target.zones = this.zones;
        if (this.drake)  {
          var drakeInstance = document.querySelector(this.drake);
          if(drakeInstance) {
            drakeInstance.register(target);
          }
        }
      },

      ready: function() {
        if(this.drake === null){
          throw new Error('<tux-drag-drop-container> without a corrosponding drake');
        }
        this.isReady = true;
      },
      attached: function() {
        this.register();
      },
      detached: function() {
        this.unregister();
      },
      register: function() {
        this.drake.split(/[,|\s]+/).forEach(function(drakeId) {
          var drakeInstance = document.querySelector(drakeId);
          if(drakeInstance) {
            var target = this.querySelector(this.for ? this.for : '.tux-drag-drop-container');
            target.zones = this['zones'];
            drakeInstance.register(target);
          }
        }, this);
      },
      unregister: function() {
        var drake = document.querySelector(this.drake);
        drake.unregister(this.querySelector(this.for ? this.for : '.tux-drag-drop-container'));
      }
    });
  </script>
</dom-module>
